<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hoau.how.module.obh.server.dao.ContactsEntityMapper" >
  <resultMap id="BaseResultMap" type="com.hoau.how.module.obh.shared.domain.ContactsEntity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jul 17 10:25:07 CST 2015.
    -->
    <id column="ebsa_id" property="ebsaId" jdbcType="NUMERIC" />
    <result column="ebsa_address" property="ebsaAddress" jdbcType="VARCHAR" />
    <result column="ebsa_contact" property="ebsaContact" jdbcType="VARCHAR" />
    <result column="ebsa_contact_tel" property="ebsaContactTel" jdbcType="VARCHAR" />
    <result column="ebsa_is_default" property="ebsaIsDefault" jdbcType="CHAR" />
    <result column="modify_time" property="modifyTime" jdbcType="TIMESTAMP" />
    <result column="modifier" property="modifier" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="creator" property="creator" jdbcType="VARCHAR" />
    <result column="ebsa_ebpv_name" property="ebsaEbpvName" jdbcType="VARCHAR" />
    <result column="ebsa_ebpl_name" property="ebsaEbplName" jdbcType="VARCHAR" />
    <result column="ebsa_ebco_name" property="ebsaEbcoName" jdbcType="VARCHAR" />
    <result column="ebsa_company" property="ebsaCompany" jdbcType="VARCHAR" />
    <result column="ebsa_contact_area_code" property="ebsaContactAreaCode" jdbcType="VARCHAR" />
    <result column="ebsa_esco_second_code" property="ebsaEscoSecondCode" jdbcType="VARCHAR" />
    <result column="ebsa_esco_second_name" property="ebsaEscoSecondName" jdbcType="VARCHAR" />
    <result column="ebsa_ebcu_id" property="ebsaEbcuId" jdbcType="NUMERIC" />
    <result column="ebsa_type" property="ebsaType" jdbcType="VARCHAR" />
    <result column="ebsa_mobile" property="ebsaMobile" jdbcType="VARCHAR" />
    <result column="ebsa_remark" property="ebsaRemark" jdbcType="VARCHAR" />
    <result column="ebsa_dept_district" property="ebsaDeptDistrict" jdbcType="VARCHAR" />
  </resultMap>
  
  <sql id="base_query_sql">
    ebsa_id as ebsaId,
	ebsa_address as ebsaAddress,
	ebsa_contact as ebsaContact,
	ebsa_contact_tel as ebsaContactTel,
	ebsa_is_default as ebsaIsDefault,
	modify_time as modifyTime,
	modifier as modifier,
	create_time as createTime,
	creator as creator,
	ebsa_ebpv_name as ebsaEbpvName,
	ebsa_ebpl_name as ebsaEbplName,
	ebsa_ebco_name as ebsaEbcoName,
	ebsa_company as ebsaCompany,
	ebsa_contact_area_code as ebsaContactAreaCode,
	ebsa_esco_second_code as ebsaEscoSecondCode,
	ebsa_esco_second_name as ebsaEscoSecondName,
	ebsa_ebcu_id as ebsaEbcuId,
	ebsa_type as ebsaType,
	ebsa_mobile as ebsaMobile,
	ebsa_remark as ebsaRemark,
	ebsa_dept_district as ebsaDeptDistrict
  </sql>
  
  <sql id="base_query_param">
      <if test="ebsaType != null and ebsaType != ''">
          AND ebsa_type = #{ebsaType,jdbcType=VARCHAR}
      </if>
      <if test="ebsaContact != null and ebsaContact != ''">
          AND ebsa_contact = #{ebsaContact,jdbcType=VARCHAR}
      </if>
      <if test="ebsaMobile != null and ebsaMobile != ''">
          AND ebsa_mobile = #{ebsaMobile,jdbcType=VARCHAR}
      </if>
      <if test="ebsaEbpvName != null and ebsaEbpvName != ''">
          AND ebsa_ebpv_name = #{ebsaEbpvName,jdbcType=VARCHAR}
      </if>
      <if test="ebsaEbplName != null and ebsaEbplName != ''">
          AND ebsa_ebpl_name = #{ebsaEbplName,jdbcType=VARCHAR}
      </if>
      <if test="ebsaEbcoName != null and ebsaEbcoName != ''">
          AND ebsa_ebco_name = #{ebsaEbcoName,jdbcType=VARCHAR}
      </if>
      <if test="ebsaAddress != null and ebsaAddress != ''">
          AND ebsa_address = #{ebsaAddress,jdbcType=VARCHAR}
      </if>
      <if test="ebsaEscoSecondCode != null and ebsaEscoSecondCode != ''">
          AND ebsa_esco_second_code = #{ebsaEscoSecondCode,jdbcType=VARCHAR}
      </if>
      <if test="ebsaEscoSecondName != null and ebsaEscoSecondName != ''">
          AND ebsa_esco_second_name = #{ebsaEscoSecondName,jdbcType=VARCHAR}
      </if>
      <if test="ebsaContactAreaCode != null and ebsaContactAreaCode != ''">
          AND ebsa_contact_area_code = #{ebsaContactAreaCode,jdbcType=VARCHAR}
      </if>
      <if test="ebsaContactTel != null and ebsaContactTel != ''">
          AND ebsa_contact_tel = #{ebsaContactTel,jdbcType=VARCHAR}
      </if>
  </sql>
  
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jul 17 10:25:07 CST 2015.
    -->
    ebsa_id, ebsa_address, 
    ebsa_contact, ebsa_contact_tel, 
    ebsa_is_default, 
    modify_time, modifier, create_time, creator, 
    ebsa_ebpv_name, ebsa_ebpl_name, ebsa_ebco_name, ebsa_company, 
    ebsa_contact_area_code, ebsa_esco_second_code, ebsa_esco_second_name, ebsa_ebcu_id, 
    ebsa_type, ebsa_mobile, ebsa_remark,ebsa_dept_district
  </sql>
  
  
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jul 17 10:25:07 CST 2015.
    -->
    select 
    <include refid="Base_Column_List" />
    from eb_shipper_address
    where ebsa_id = #{ebsaId,jdbcType=NUMERIC}
    AND modifier=#{modifier}
  </select>
  <delete id="deleteByPrimaryKey">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jul 17 10:25:07 CST 2015.
    -->
    delete from eb_shipper_address
    where 
    ebsa_ebcu_id=#{userId,jdbcType=NUMERIC} 
    and 
    ebsa_id=#{contactsId,jdbcType=NUMERIC}
  </delete>
  
  <insert id="insert" parameterType="com.hoau.how.module.obh.shared.domain.ContactsEntity" keyProperty="ebsaId" useGeneratedKeys="true">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jul 17 10:25:07 CST 2015.
    -->
    insert into eb_shipper_address ( 
      ebsa_address, 
      ebsa_contact, ebsa_contact_tel, 
      ebsa_is_default, modify_time, modifier, 
      create_time, creator, ebsa_ebpv_name, 
      ebsa_ebpl_name, 
      ebsa_ebco_name, ebsa_company, ebsa_contact_area_code, 
      ebsa_esco_second_code, ebsa_esco_second_name, 
      ebsa_ebcu_id, ebsa_type, ebsa_mobile, 
      ebsa_remark,ebsa_dept_district)
    values (
      #{ebsaAddress,jdbcType=VARCHAR}, 
      #{ebsaContact,jdbcType=VARCHAR}, #{ebsaContactTel,jdbcType=VARCHAR},
      #{ebsaIsDefault,jdbcType=CHAR}, 
      now(), #{modifier,jdbcType=VARCHAR}, 
      now(), #{creator,jdbcType=VARCHAR},#{ebsaEbpvName,jdbcType=VARCHAR}, 
      #{ebsaEbplName,jdbcType=VARCHAR}, 
      #{ebsaEbcoName,jdbcType=VARCHAR}, #{ebsaCompany,jdbcType=VARCHAR}, #{ebsaContactAreaCode,jdbcType=VARCHAR}, 
      #{ebsaEscoSecondCode,jdbcType=VARCHAR}, #{ebsaEscoSecondName,jdbcType=VARCHAR}, 
      #{ebsaEbcuId,jdbcType=NUMERIC}, #{ebsaType,jdbcType=VARCHAR}, #{ebsaMobile,jdbcType=VARCHAR}, 
      #{ebsaRemark,jdbcType=VARCHAR},#{ebsaDeptDistrict,jdbcType=VARCHAR})
  </insert>
  
  <update id="updateByPrimaryKey" parameterType="com.hoau.how.module.obh.shared.domain.ContactsEntity" >
    update eb_shipper_address
    <set> 
		<if test="ebsaAddress != null">  
			ebsa_address = #{ebsaAddress,jdbcType=VARCHAR},
		</if>
		<if test="ebsaContact != null">  
			ebsa_contact = #{ebsaContact,jdbcType=VARCHAR},
		</if>
		<if test="ebsaContactTel != null">  
			ebsa_contact_tel = #{ebsaContactTel,jdbcType=VARCHAR},
		</if>
		<if test="ebsaIsDefault != null">  
			ebsa_is_default = #{ebsaIsDefault,jdbcType=CHAR},
		</if>
		<if test="modifyTime != null">  
			modify_time = #{modifyTime,jdbcType=TIMESTAMP},
		</if>
		<if test="modifier != null">  
			modifier = #{modifier,jdbcType=VARCHAR},
		</if>
		<if test="createTime != null">  
			create_time = #{createTime,jdbcType=TIMESTAMP},
		</if>
		<if test="creator != null">  
			creator = #{creator,jdbcType=VARCHAR},
		</if>
		<if test="ebsaEbpvName != null">  
			ebsa_ebpv_name = #{ebsaEbpvName,jdbcType=VARCHAR},
		</if>
		<if test="ebsaEbplName != null">  
			ebsa_ebpl_name = #{ebsaEbplName,jdbcType=VARCHAR},
		</if>
		<if test="ebsaEbcoName != null">  
			ebsa_ebco_name = #{ebsaEbcoName,jdbcType=VARCHAR},
		</if>
		<if test="ebsaCompany != null">  
			ebsa_company = #{ebsaCompany,jdbcType=VARCHAR},
		</if>
		<if test="ebsaContactAreaCode != null">  
			ebsa_contact_area_code= #{ebsaContactAreaCode,jdbcType=VARCHAR},
		</if>
		<if test="ebsaEscoSecondCode != null">  
			ebsa_esco_second_code = #{ebsaEscoSecondCode,jdbcType=VARCHAR},
		</if>
		<if test="ebsaEscoSecondName != null">  
			ebsa_esco_second_name = #{ebsaEscoSecondName,jdbcType=VARCHAR},
		</if>
		<if test="ebsaEbcuId != null">  
			ebsa_ebcu_id = #{ebsaEbcuId,jdbcType=NUMERIC},
		</if>
		<if test="ebsaType != null">  
			ebsa_type = #{ebsaType,jdbcType=VARCHAR},
		</if>
		<if test="ebsaMobile != null">  
			ebsa_mobile = #{ebsaMobile,jdbcType=VARCHAR},
		</if>
		<if test="ebsaRemark != null">  
			ebsa_remark = #{ebsaRemark,jdbcType=VARCHAR}
		</if>
		<if test="ebsaDeptDistrict != null">  
			ebsa_dept_district = #{ebsaDeptDistrict,jdbcType=VARCHAR}
		</if>
      </set> 
    where ebsa_id = #{ebsaId,jdbcType=NUMERIC}
  </update>
  
  <select id="queryMyContactsPage" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from eb_shipper_address
    where 
    ebsa_ebcu_id = #{contactsEntity.ebsaId,jdbcType=NUMERIC}
    and ebsa_type = #{type,jdbcType=VARCHAR} 
    <if test="contactsEntity.ebsaMobile != null and contactsEntity.ebsaMobile != '' ">  
        AND 
        (
        ebsa_contact like CONCAT('%',#{contactsEntity.ebsaMobile,jdbcType=VARCHAR},'%')
        or  
        ebsa_mobile like CONCAT('%',#{contactsEntity.ebsaMobile,jdbcType=VARCHAR},'%')
        or 
        ebsa_contact_tel like CONCAT('%',#{contactsEntity.ebsaMobile,jdbcType=VARCHAR},'%')
        
        )  
    </if>
    order by ebsa_is_default desc 
    limit #{pageSize,jdbcType=VARCHAR} offset #{offset,jdbcType=VARCHAR}
  </select>
  
  <select id="queryMyContacts" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from eb_shipper_address
    where ebsa_ebcu_id = #{userId,jdbcType=NUMERIC}
    and ebsa_type = #{type,jdbcType=VARCHAR} order by ebsa_is_default desc 
  </select>
  
  <select id="findDefualt" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from eb_shipper_address
    where ebsa_ebcu_id = #{userId,jdbcType=NUMERIC}
    and ebsa_type = #{type,jdbcType=VARCHAR} and ebsa_is_default = 'Y'
  </select>
  
  <!-- 设为默认 -->
  <update id="setDefault">
    update eb_shipper_address
    set ebsa_is_default = 'Y'
    where ebsa_id = #{contactsIds,jdbcType=NUMERIC}
    and ebsa_ebcu_id = #{userId,jdbcType=NUMERIC}
  </update>
  
  <!-- 设为非默认 -->
  <update id="setNotDefault">
    update eb_shipper_address
    set ebsa_is_default = 'N'
    where ebsa_id != #{contactsIds,jdbcType=NUMERIC}
    and ebsa_ebcu_id = #{userId,jdbcType=NUMERIC}
    and ebsa_type = #{contactsType,jdbcType=VARCHAR}
  </update>
  
  <select id="contactsTotals" resultType="int">
    select 
    count(ebsa_id)
    from eb_shipper_address where ebsa_ebcu_id = #{userId,jdbcType=NUMERIC}
    and ebsa_type = #{type,jdbcType=VARCHAR}
  </select>
  
  <select id="queryContact" parameterType="com.hoau.how.module.obh.shared.domain.ContactsEntity" 
      resultType="com.hoau.how.module.obh.shared.domain.ContactsEntity">
    SELECT 
    <include refid="base_query_sql"></include>
    FROM EB_SHIPPER_ADDRESS
    <trim prefix="WHERE" prefixOverrides="AND | OR">
	    <include refid="base_query_param"></include>
	</trim>
  </select>
  
  <!--根据主键查找手机号  -->
    <select id="selectMobileById" resultType="String">
       SELECT ebsa_mobile FROM 
            eb_shipper_address 
            where ebsa_id=#{id,jdbcType=NUMERIC}      
    </select>
  
</mapper>